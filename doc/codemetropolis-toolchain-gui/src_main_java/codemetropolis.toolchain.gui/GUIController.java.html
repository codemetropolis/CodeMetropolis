<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../jacoco-resources/report.gif" type="image/gif"/><title>GUIController.java</title><link rel="stylesheet" href="../../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">Merged (Apr 21, 2018 5:41:32 PM)</a> &gt; <a href="../../index.html" class="el_group">codemetropolis-toolchain-gui</a> &gt; <a href="../index.html" class="el_bundle">src/main/java</a> &gt; <a href="index.source.html" class="el_package">codemetropolis.toolchain.gui</a> &gt; <span class="el_source">GUIController.java</span></div><h1>GUIController.java</h1><pre class="source lang-java linenums">package codemetropolis.toolchain.gui;

import java.io.File;
import java.io.PrintStream;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Date;
import java.util.List;

import codemetropolis.toolchain.gui.beans.ExecutionException;
import codemetropolis.toolchain.gui.beans.ExecutionOptions;
import codemetropolis.toolchain.gui.components.CMMetricPanel;
import codemetropolis.toolchain.gui.executors.ConverterToolExecutor;
import codemetropolis.toolchain.gui.executors.MappingToolExecutor;
import codemetropolis.toolchain.gui.executors.MetricGeneratorExecutor;
import codemetropolis.toolchain.gui.executors.PlacingToolExecutor;
import codemetropolis.toolchain.gui.executors.RenderingToolExecutor;
import codemetropolis.toolchain.gui.metricgenerators.SonarQubeGenerator;
import codemetropolis.toolchain.gui.metricgenerators.SourceMeterGenerator;
import codemetropolis.toolchain.gui.utils.Translations;

/**
 * Controller class for the GUI that handles tasks like managing the toolchain execution.
 *
 * @author Abel Szkalisity {@literal &lt;SZAVAET.SZE&gt;}
 */
public class GUIController {

<span class="nc" id="L29">  private static final SimpleDateFormat DATE_FORMATTER = new SimpleDateFormat(&quot;yyyyMMdd-hhmmss-SSS&quot;);</span>

  private ExecutionOptions executionOptions;
<span class="nc" id="L32">  private List&lt;CMMetricPanel&gt; metricGeneratorPanels = new ArrayList&lt;CMMetricPanel&gt;();</span>

  /**
   * Instantiates a {@link GUIController} and adds the available metricGeneration options.
   */
<span class="nc" id="L37">  public GUIController() {</span>
<span class="nc" id="L38">    executionOptions = new ExecutionOptions();</span>

<span class="nc" id="L40">    metricGeneratorPanels.add(new SourceMeterGenerator());</span>
<span class="nc" id="L41">    metricGeneratorPanels.add(new SonarQubeGenerator());</span>
<span class="nc" id="L42">  }</span>

  /**
   * Handles toolchain execution. Creates the folder that stores the intermediate project files, then it runs each part
   * of the toolchain in sequence.
   *
   * @param out The {@link PrintStream} instance that will be set for each executor, so we can read their outputs and
   *          display them for the user.
   * @throws ExecutionException if any exception occurs during execution.
   */
  public void execute(PrintStream out) throws ExecutionException {
    try {
<span class="nc" id="L54">      File projectRoot = createTargetFolder();</span>

<span class="nc" id="L56">      new MetricGeneratorExecutor().execute(projectRoot, executionOptions, out);</span>
<span class="nc" id="L57">      new ConverterToolExecutor().execute(projectRoot, executionOptions, out);</span>
<span class="nc" id="L58">      new MappingToolExecutor().execute(projectRoot, executionOptions, out);</span>
<span class="nc" id="L59">      new PlacingToolExecutor().execute(projectRoot, executionOptions, out);</span>
<span class="nc" id="L60">      new RenderingToolExecutor().execute(projectRoot, executionOptions, out);</span>
<span class="nc" id="L61">    } catch (Exception e) {</span>
<span class="nc" id="L62">      throw new ExecutionException(&quot;Toolchain execution failed!&quot;, e);</span>
<span class="nc" id="L63">    }</span>
<span class="nc" id="L64">  }</span>

  /**
   * Creates the folder that will be used to store the intermediate project files.
   *
   * @return The {@link File} object for the generated directory.
   * @throws ExecutionException if creating the directory failed.
   */
  private File createTargetFolder() throws ExecutionException {
<span class="nc" id="L73">    File cmRoot = new File(executionOptions.getMinecraftRoot().getAbsolutePath() + File.separator + &quot;.code-metropolis&quot;);</span>
<span class="nc bnc" id="L74" title="All 2 branches missed.">    if (!cmRoot.exists()) {</span>
<span class="nc" id="L75">      cmRoot.mkdir();</span>
    }

<span class="nc" id="L78">    File projectRoot = new File(cmRoot.getAbsolutePath() + File.separator + getCurrentDateString());</span>
<span class="nc bnc" id="L79" title="All 2 branches missed.">    if (!projectRoot.mkdir()) {</span>
<span class="nc" id="L80">      throw new ExecutionException(Translations.t(&quot;gui_err_mkdir_project_failed&quot;));</span>
    }
<span class="nc" id="L82">    return projectRoot;</span>
  }

  /**
   * Gets the current date and time, then returns a formatted version of it, that can act as a valid directory name.
   *
   * @return The formatted date and time.
   */
  private String getCurrentDateString() {
<span class="nc" id="L91">    return DATE_FORMATTER.format(new Date());</span>
  }

  public ExecutionOptions getExecutionOptions() {
<span class="nc" id="L95">    return executionOptions;</span>
  }

  public List&lt;CMMetricPanel&gt; getMetricGeneratorPanels() {
<span class="nc" id="L99">    return metricGeneratorPanels;</span>
  }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.9.201702052155</span>Merged (Apr 21, 2018 5:41:32 PM)</div></body></html>